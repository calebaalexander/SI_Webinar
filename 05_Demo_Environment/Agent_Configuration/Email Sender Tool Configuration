-- Email Sender Tool Configuration for Zoomi Business Intelligence Agent
-- This script configures the email sending tool for the agent

USE ROLE SNOWFLAKE_INTELLIGENCE_ADMIN_RL;
USE DATABASE ZOOMI_INTELLIGENCE_DEMO;
USE SCHEMA AGENTS;

-- Email Sender Tool Configuration
-- This tool allows the agent to send formatted emails with business insights

-- Tool Specification for Email Sender
-- Name: email_sender
-- Resource Type: procedure
-- Parameters: recipient (email address), subject (email subject), content (email content)
-- Description: Sends formatted HTML emails with business insights and reports

-- Example usage in agent instructions:
/*
When using the email_sender tool:
1. Always format emails in a professional, HTML format
2. Use the FORMAT_EMAIL_CONTENT function for consistent styling
3. Include relevant business insights and data visualizations
4. Structure emails with clear headers, content sections, and professional footer
5. Use appropriate subject lines that reflect the email content
6. Ensure all data and insights are accurate and up-to-date

Example email structure:
- Professional header with company branding
- Executive summary of key insights
- Detailed analysis with supporting data
- Actionable recommendations
- Professional footer with contact information
*/

-- Sample email templates for different use cases:

-- 1. Sales Performance Report Email
SELECT ZOOMI_INTELLIGENCE_DEMO.AGENTS.FORMAT_EMAIL_CONTENT(
    'Zoomi Sales Performance Report - Q1 2024',
    CONCAT(
        '<h2>Executive Summary</h2>',
        '<p>Q1 2024 sales performance shows strong growth across all regions.</p>',
        '<h3>Key Highlights:</h3>',
        '<ul>',
        '<li>Total revenue: $28,110 (vs $28,099 forecast)</li>',
        '<li>North America leads with 56% of total sales</li>',
        '<li>PetTracker product exceeds forecast by 15%</li>',
        '</ul>',
        '<h3>Regional Performance:</h3>',
        '<ul>',
        '<li><strong>North America:</strong> $15,718 actual vs $15,713 forecast</li>',
        '<li><strong>Europe:</strong> $6,536 actual vs $6,533 forecast</li>',
        '<li><strong>Asia Pacific:</strong> $5,856 actual vs $5,853 forecast</li>',
        '</ul>',
        '<h3>Recommendations:</h3>',
        '<ul>',
        '<li>Scale successful North American marketing strategies to other regions</li>',
        '<li>Increase PetTracker production capacity</li>',
        '<li>Focus on European market expansion opportunities</li>',
        '</ul>'
    ),
    'Zoomi Pet Wellness - Business Intelligence Report'
) AS sales_report_template;

-- 2. Marketing Campaign Analysis Email
SELECT ZOOMI_INTELLIGENCE_DEMO.AGENTS.FORMAT_EMAIL_CONTENT(
    'Marketing Campaign Performance Analysis',
    CONCAT(
        '<h2>Campaign Performance Overview</h2>',
        '<p>Analysis of recent marketing campaigns and their impact on sales performance.</p>',
        '<h3>Campaign Results:</h3>',
        '<ul>',
        '<li>North American campaign exceeded expectations by 15%</li>',
        '<li>New marketing strategy resonates well with pet owners</li>',
        '<li>Supply chain optimization reducing costs by 8%</li>',
        '</ul>',
        '<h3>Customer Engagement:</h3>',
        '<ul>',
        '<li>Strong engagement metrics in target demographics</li>',
        '<li>Positive feedback on product features and quality</li>',
        '<li>High customer satisfaction scores</li>',
        '</ul>',
        '<h3>Next Steps:</h3>',
        '<ul>',
        '<li>Expand successful campaigns to European markets</li>',
        '<li>Implement cost optimization strategies</li>',
        '<li>Enhance customer feedback collection</li>',
        '</ul>'
    ),
    'Zoomi Marketing Intelligence Report'
) AS marketing_report_template;

-- 3. Operational Efficiency Report Email
SELECT ZOOMI_INTELLIGENCE_DEMO.AGENTS.FORMAT_EMAIL_CONTENT(
    'Operational Efficiency and Team Collaboration Report',
    CONCAT(
        '<h2>Operational Performance Summary</h2>',
        '<p>Analysis of team collaboration, project status, and operational efficiency.</p>',
        '<h3>Team Collaboration Insights:</h3>',
        '<ul>',
        '<li>Strong cross-functional communication patterns</li>',
        '<li>Effective project milestone tracking</li>',
        '<li>Positive team feedback on new processes</li>',
        '</ul>',
        '<h3>Process Improvements:</h3>',
        '<ul>',
        '<li>Supply chain optimization with new supplier approved</li>',
        '<li>Product enhancement with v2.1 firmware rollout</li>',
        '<li>Improved GPS accuracy and extended battery life</li>',
        '</ul>',
        '<h3>Performance Metrics:</h3>',
        '<ul>',
        '<li>100,000+ active pet tracking devices milestone reached</li>',
        '<li>8% cost reduction from supply chain improvements</li>',
        '<li>Enhanced delivery times and customer satisfaction</li>',
        '</ul>'
    ),
    'Zoomi Operations Intelligence Report'
) AS operations_report_template;

-- Agent Tool Integration Instructions
/*
To integrate the email_sender tool with the Zoomi Business Intelligence Agent:

1. Add the tool to the agent's tool specification:
   {
     "tool_spec": {
       "type": "procedure",
       "name": "email_sender",
       "description": "Send formatted HTML emails with business insights and reports",
       "parameters": {
         "recipient": "Email address to send the report to",
         "subject": "Subject line for the email",
         "content": "HTML formatted email content with business insights"
       }
     }
   }

2. Update agent instructions to include email capabilities:
   - "You can send automated email reports with business insights"
   - "Use the email_sender tool to distribute reports to stakeholders"
   - "Format emails professionally using HTML and include relevant data"
   - "Always verify data accuracy before sending reports"

3. Example agent query: "Send a sales performance report to john.doe@company.com"
*/

-- Verification that email components are properly configured
SELECT 
    'Email Integration Status' as check_type,
    CASE 
        WHEN EXISTS (
            SELECT 1 FROM SNOWFLAKE.ACCOUNT_USAGE.INTEGRATIONS 
            WHERE INTEGRATION_NAME = 'ZOOMI_EMAIL_INT' AND ENABLED = TRUE
        ) THEN '✅ Email Integration Active'
        ELSE '❌ Email Integration Not Found or Disabled'
    END as status;

SELECT 
    'Stored Procedure Status' as check_type,
    CASE 
        WHEN EXISTS (
            SELECT 1 FROM ZOOMI_INTELLIGENCE_DEMO.INFORMATION_SCHEMA.PROCEDURES 
            WHERE PROCEDURE_NAME = 'SEND_MAIL'
        ) THEN '✅ Send Mail Procedure Available'
        ELSE '❌ Send Mail Procedure Not Found'
    END as status;

SELECT 
    'Helper Function Status' as check_type,
    CASE 
        WHEN EXISTS (
            SELECT 1 FROM ZOOMI_INTELLIGENCE_DEMO.INFORMATION_SCHEMA.FUNCTIONS 
            WHERE FUNCTION_NAME = 'FORMAT_EMAIL_CONTENT'
        ) THEN '✅ Email Formatting Function Available'
        ELSE '❌ Email Formatting Function Not Found'
    END as status; 
